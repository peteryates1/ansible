# Claude Code VM defaults
vm_type: "claude"

extra_users:
  - name: claude
    sudo: true
    shell: /bin/bash
    ssh_keys: true

extra_packages: []

extra_runcmd:
  # Generate SSH keypair for claude user
  - |
    sudo -u claude bash << 'KEYSCRIPT'
    mkdir -p ~/.ssh
    chmod 700 ~/.ssh
    if [ ! -f ~/.ssh/id_ed25519 ]; then
      ssh-keygen -t ed25519 -f ~/.ssh/id_ed25519 -N "" -C "claude@$(hostname)"
    fi
    KEYSCRIPT
  # Install Claude Code
  - |
    sudo -u claude bash << 'SCRIPT'
    set -e
    cd /home/claude
    curl -fsSL https://claude.ai/install.sh | bash
    echo 'export PATH="$HOME/.local/bin:$PATH"' >> ~/.bashrc
    SCRIPT
  - echo "Claude Code installation complete" >> /var/log/cloud-init-output.log
