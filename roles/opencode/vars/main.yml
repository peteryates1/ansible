# OpenCode VM defaults
vm_type: "opencode"

extra_users:
  - name: opencode
    sudo: true
    shell: /bin/bash
    ssh_keys: true

extra_packages: []

extra_runcmd:
  # Generate SSH keypair for opencode user
  - |
    sudo -u opencode bash << 'KEYSCRIPT'
    mkdir -p ~/.ssh
    chmod 700 ~/.ssh
    if [ ! -f ~/.ssh/id_ed25519 ]; then
      ssh-keygen -t ed25519 -f ~/.ssh/id_ed25519 -N "" -C "opencode@$(hostname)"
    fi
    KEYSCRIPT
  # Install OpenCode
  - |
    sudo -u opencode bash << 'SCRIPT'
    set -e
    cd /home/opencode
    curl -fsSL https://opencode.ai/install | bash
    echo 'export PATH="$HOME/.local/bin:$PATH"' >> ~/.bashrc
    SCRIPT
  - echo "OpenCode installation complete" >> /var/log/cloud-init-output.log
